!function(e){"use strict";function t(t,n,r,i,o){function a(t){var n={};return e.forEach(t,function(e){n[e]={},n[e].templateUrl=s+"/"+e+".html","404"!==e&&(n[e].controller=e),"layout"===e&&(n[e].views={layout:n.layout,"@layout":n.archive,"@layout.home":n.archive}),"admin"===e&&(n[e].resolve={loadEditor:["$ocLazyLoad",u]})}),n}function u(e){return e.load("EditorNinja").then(function(){e.load("EditorNinja.upload")})}function c(t,n,r){var i=e.copy(n);return i.url=t,r&&"object"==typeof r&&(i=e.extend(i,r)),i}function d(e){return{data:{title:e}}}var l=airpubConfigs.theme||"chill",s=(airpubConfigs.themePath||"bower_components")+"/"+l,f=airpubConfigs.staticPath||"",g=a(["archive","single","admin","404","layout"]);n.otherwise("/404"),t.state("layout",c("",g.layout)).state("layout.home",c("/",g.layout)).state("layout.pager",c("/page/:page",g.archive)).state("layout.single",c("/article/:uri",g.single)).state("layout.create",c("/create",g.admin,d("写新文章"))).state("layout.update",c("/article/:uri/update",g.admin,d("更新文章"))).state("layout.404",c("/404",g[404])),i.config({modules:[{name:"EditorNinja",files:[f+"bower_components/ninja/dist/ninja.min.js",f+"bower_components/ninja/dist/ninja.min.css"]},{name:"EditorNinja.upload",files:[f+"bower_components/ninja/dist/ninja.min.js"]}]}),r.hashPrefix(airpubConfigs.hashPrefix||"!"),airpubConfigs.html5Mode&&r.html5Mode(!0),airpubConfigs.upyun&&o.config(airpubConfigs.upyun)}e.module("airpub",["upyun","duoshuo","ui.router","ui.bootstrap","oc.lazyLoad"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$ocLazyLoadProvider","upyunProvider",t])}(window.angular),function(e){"use strict";function t(e){return function(t){function n(e,t){return e="object"==typeof e?e.join(" "):e,['<section class="'+e+'">','<div class="container">','<div class="row">','<div class="col-lg-8 col-lg-offset-2">',t,"</div>","</div>","</div>","</section>"].join("\n")}function r(e){return hljs.highlightAuto(e).value}if(!t)return"";if(!marked)throw new Error("marked.js required!");var i={};hljs&&(i.highlight=r);var o=new marked.Renderer;return o.code=function(e,t,r){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(r=!0,e=i)}return n("code-section",'<pre><code class="'+t+'">'+e+"</code></pre>")},o.html=function(e){return n("html-section",e)},o.heading=function(e,t){var r=t;return n("heading-section","<h"+r+">"+e+"</h"+r+">")},o.paragraph=function(e){return n("paragraph-section","<p>"+e+"</p>")},o.blockquote=function(e){return n("blockquote-section","<blockquote>"+e+"</blockquote>")},o.list=function(e,t){var r=t?"o":"u";return n("blockquote-section","<"+r+"l>"+e+"</"+r+"l>")},i.renderer=o,marked.setOptions(i),e.trustAsHtml(marked(t))}}e.module("airpub").filter("marked",["$sce",t])}(window.angular),function(e){"use strict";function t(e){return airpubConfigs?void(e.configs=airpubConfigs):console.error(new Error("airpub 缺少必要的配置文件!"))}e.module("airpub").controller("global",["$scope",t])}(window.angular),function(e){"use strict";function t(t,r){t.title=t.configs.name||"Airpub",t.description=t.configs.description||"just another Airpub blog",n(t.configs),r.$on("updateMeta",function(n,r){return"string"==typeof r?t.title=r:void e.forEach(r,function(e,n){t[n]=e})})}function n(e){if(window.wechat){var t=window.wechat,n={};e.url&&(n.link=e.url),e.name&&(n.title=e.name),e.description&&(n.desc=e.description),t("friend",n),t("timeline",n),t("weibo",n)}}e.module("airpub").controller("meta",["$scope","$rootScope",t])}(window.angular),function(e){"use strict";function t(t,n,r,i,o){function a(e,n){var r=0===n.user_id;return e||r?void(t.isVisitor=!0):void(t.user=n)}function u(){t.hiddenSigninSection=!t.hiddenSigninSection}function c(e,n,i){t.alerts.push({msg:e,type:n||"success"});var o=t.alerts.length-1;return r(function(){t.closeAlert(o)},i?1e3*i:3e3),o}function d(e){t.alerts.splice(e,1)}function l(t,n){if(t&&(0===t.indexOf("http")||0===t.indexOf("https"))){var r=n||document.getElementsByTagName("header")[0];r&&e.element(r).css({"background-image":"url("+t+")"})}}t.location=i,t.state=n,t.hiddenSigninSection=!0,t.toggleSigninSection=u,t.alerts=[],t.addAlert=c,t.closeAlert=d,t.updateBackground=l,t.copyrightYear=(new Date).getFullYear(),o.on("ready",a)}function n(){}e.module("airpub").controller("layout",["$scope",n]).controller("base",["$scope","$state","$timeout","$location","$duoshuo",t])}(window.angular),function(e){"use strict";function t(e,t,n,r){function i(e){return e&&!isNaN(parseInt(e))?parseInt(e):!1}if(e.itemsPerPage=10,e.currentPage=i(t.params.page)||1,r.$emit("updateMeta",e.configs.name),!(e.articles&&e.articles.length>0)){if(t.params.page)var o=!0,a=e.currentPage;n.get("threads/list",{page:e.currentPage,limit:e.itemsPerPage,with_content:1},function(n,r,i){return t.params.page&&(o=!1),n?e.addAlert("获取信息失败，请重试","danger"):0===r.length?t.go("layout.404"):(e.articles=r||[],e.totalItems=i.cursor.total,void(t.params.page&&(e.currentPage=a)))},function(){return t.go("layout.404")}),e.pageChanged=function(){o||t.go("layout.pager",{page:e.currentPage})}}}e.module("airpub").controller("archive",["$scope","$state","$duoshuo","$rootScope",t])}(window.angular),function(e){"use strict";function t(e,t,i,o){var a=t.params.uri;return a?(e.articleID=a,void(e.article||i.get("threads/details",{thread_id:a},function(t,a){return t?e.addAlert("文章内容获取失败，请稍后再试...","danger"):(e.article=a,o.$emit("updateMeta",{title:a.title,description:n(a.content)}),a.meta&&a.meta.background&&e.updateBackground(a.meta.background),e.article&&r(e.article),void(a.author_id&&i.get("users/profile",{user_id:a.author_id},function(t,n){t||(e.author=n,e.author.description=n.connected_services.weibo?n.connected_services.weibo.description:null)})))},function(){return t.go("layout.404")}))):t.go("layout.404")}function n(e){var t=80;return e?e.length<=t?e:e.substr(0,t)+"...":""}function r(e){if(window.wechat){var t=window.wechat,n=42,r={};r.link=e.url,r.title=e.title,r.desc=e.content.substr(0,n)+(e.content.length>n?"...":""),e.meta&&e.meta.background&&(r.img=e.meta.background),t("friend",r),t("timeline",r),t("weibo",r)}}e.module("airpub").controller("single",["$scope","$state","$duoshuo","$rootScope",t])}(window.angular),function(e){"use strict";function t(t,n,r,i,o){function a(){o.$emit("updateMeta",n.current.data.title),r.get("sites/membership",{},function(e,i){if(e||"administrator"!==i.role)return n.go("layout.home");var o="layout.update"===n.current.name&&n.params.uri;return o?void r.get("threads/details",{thread_id:n.params.uri},function(e,n){return t.isAdmin=!0,e?t.addAlert("文章内容获取失败，请稍后再试...","danger"):void(t.article=n)},function(){return t.addAlert("文章内容获取失败，请稍后再试...","danger")}):void(t.isAdmin=!0)},function(e){t.addAlert(e.errorMessage,"danger"),n.go("layout.home")})}function u(){if(!t.isAdmin)return!1;if(!t.article.title)return t.addAlert("至少写个标题咯...","danger");if(!t.article.content)return t.addAlert("至少写点内容咯...","danger");var e={};e.format="markdown",e.title=t.article.title,e.content=t.article.content,e.thread_key=uuid.v1(),e=l(e),f("beforeCreate",e),r.post("threads/create",e,function(e,i){return e?t.addAlert("发布失败...","danger"):(t.addAlert("发布成功"),r.post("threads/update",{thread_id:i.thread_id,url:g+m+"/article/"+i.thread_id},function(e){e&&console.log(e),n.go("layout.single",{uri:i.thread_id})}),void f("afterCreate",i))},function(){return t.addAlert("发布失败...","danger")})}function c(e){if(!e)return t.createArticle();if(!t.isAdmin)return!1;var i={};i.thread_id=e,i.title=t.article.title,i.content=t.article.content,i.url=g+m+"/article/"+e,i=l(i),f("beforeUpdate",i),r.post("threads/update",i,function(r,i){return r?t.addAlert("更新失败，请稍后再试...","danger"):(t.addAlert("更新成功!"),f("afterUpdate",i),void n.go("layout.single",{uri:e}))},function(){return t.addAlert("更新失败，请稍后再试...","danger")})}function d(e){return e&&t.isAdmin?(f("beforeRemove",e),void r.post("threads/remove",{thread_id:e},function(r){return r?t.addAlert("删除失败，请稍后再试...","danger"):(f("afterRemove",e),t.addAlert("删除成功!"),void n.go("layout.home"))},function(){return t.addAlert("删除失败，请稍后再试...","danger")})):!1}function l(n){return t.article.meta?(e.forEach(t.article.meta,function(e,t){n["meta["+t+"]"]=e}),n):n}function s(e,n){return e&&n&&"function"==typeof n?(t.bindedEvents||(t.bindedEvents={}),t.bindedEvents[e]=n,t.bindedEvents):!1}function f(e,n){return t.bindedEvents&&t.bindedEvents[e]?t.bindedEvents[e](n||t.article,e):void 0}t.isAdmin=!1;var g=t.configs.url||i.host(),p=t.configs.hashPrefix||"!",m="/#"+p;a(),t.createArticle=u,t.updateArticle=c,t.removeArticle=d,t.on=s}e.module("airpub").controller("admin",["$scope","$state","$duoshuo","$location","$rootScope",t])}(window.angular),function(){"use strict";function e(e){function t(t,n,r,i){function o(){c||(c=!0,e.upload("metaBackgroundForm",function(e,t,n){if(c=!1,e)return console.error(e),alert("上传失败，请稍后再试...");var r=200===n.code&&"ok"===n.message;r&&(a(n.absUrl),i.$setViewValue(n.absUrl))}))}function a(e){if(e&&0===e.indexOf("http")){var t=document.getElementsByTagName("header")[0],n=document.getElementById("metaBackground");if(t){var r={};r["background-image"]="url("+e+")",u(t).css(r),u(n).css(r)}}}var u=angular.element,c=!1,d=document.getElementById("uploadBackgroundBtn");u(d).on("change",o),i.$render=function(){a(i.$viewValue)}}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaBackground" class="meta-background clearfix">','<form name="metaBackgroundForm">','<input type="file" name="file" id="uploadBackgroundBtn" class="pull-left hidden-input"/>','<span class="upload-background-btn fa fa-cloud-upload">',"上传背景图片","</span>","</form>","</div>"].join("\n")};return n}function t(e){function t(e,t,n,r){function i(){r.$setViewValue(e.checkToShare)}function o(e){return function(e){return}}e.checkToShare=!1,e.updateCheckStatus=i,e.on("afterCreate",o()),e.on("afterUpdate",o())}var n={restrict:"AE",require:"ngModel",replace:!0,link:t,template:['<div id="metaShare" class="meta-share clearfix"">','<input type="checkbox" id="checkToShare" ng-model="checkToShare" ng-change="updateCheckStatus()" />','<label for="checkToShare">分享到微博</label>',"</div>"].join("\n")};return n}angular.module("airpub").directive("metaBackground",["upyun",e]).directive("metaShare",["$duoshuo",t])}();
//# sourceMappingURL=airpub.min.js.map